<?xml version="1.0" encoding="UTF-8"?><!--Converted at: Wed May 11 15:49:38 KST 2016-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="codegurus.schedule.ScheduleDAO">

	<!-- 온라인 과목 목록 조회 -->
	<select id="selectSubjectList" resultType="ResSubjectListElemVO">
		SELECT
			online_subject_id,
		    service_title,
		    subject_title,
		    use_ornot,
		    apply_start_date,
		    apply_end_date,
			reg_id,
			DF14(reg_date) as reg_date,
			modify_id,
	        DF14(modify_date) as modify_date,
			delete_ornot
		FROM
			online_subject
		WHERE 1=1
		and use_ornot = 'Y'
		and delete_ornot = 'N'
		ORDER BY online_subject_id
	</select>

	<resultMap id="ScheduleMap" type="ResScheduleVO" autoMapping="true">
		<association property="book" javaType = "BookVO" autoMapping="true">
			<result property="bookId" column="book_id"/>
			<association property="bookThumbnail" javaType="FileVO" autoMapping="true" />
		</association>
	</resultMap>
	<!-- 도서일정 목록 조회 -->
	<select id="selectBookScheduleList" resultMap="ScheduleMap">
		SELECT /* selectScheduleList */
			schedule.online_subject_schedule_id,
		    schedule.online_subject_id,
		    schedule.`year`,
		    schedule.`month`,
		    schedule.seq,
		    schedule.active_ornot,

		    book.book_id,
			book.book_thumbnail_file_id,

		    COMTNFILE.ATCH_FILE_ID,
			COMTNFILEDETAIL.FILE_CN,
			COMTNFILEDETAIL.FILE_SN,
			COMTNFILEDETAIL.FILE_STRE_COURS,
			COMTNFILEDETAIL.STRE_FILE_NM,
			COMTNFILEDETAIL.FILE_EXTSN,
			COMTNFILEDETAIL.ORIGNL_FILE_NM,
			COMTNFILEDETAIL.FILE_SIZE,
			COMTNFILE.CREAT_DT,
			COMTNFILEDETAIL.DOWNLOAD_CNT
		FROM online_subject_schedule schedule
		INNER JOIN contents contents
			on schedule.contents_id = contents.contents_id
		INNER JOIN book book
			on contents.book_id = book.book_id
		LEFT JOIN COMTNFILE
			on book.book_thumbnail_file_id = COMTNFILE.ATCH_FILE_ID
		LEFT JOIN COMTNFILEDETAIL
			on book.book_thumbnail_file_id = COMTNFILEDETAIL.ATCH_FILE_ID
		WHERE 1=1
		AND schedule.online_subject_id = #{onlineSubjectId}
		AND schedule.active_ornot = 'Y'
		AND schedule.delete_ornot = 'N'
		ORDER BY schedule.`year`, schedule.`month`, schedule.month
	</select>

	<!-- 이달의 도서 목록 조회 -->
	<select id="selectThisMonthBookList" resultType="ResScheduleVO">
		SELECT /* selectMonthScheduleList */
			online_subject_schedule_id,
			online_subject_id
		FROM online_subject_schedule
		WHERE 1=1
		  AND online_subject_id = #{onlineSubjectId}
		  AND `month` = DATE_FORMAT(CURRENT_DATE , '%m')
		  AND active_ornot = 'Y'
		  AND delete_ornot = 'N'
		ORDER BY seq asc
	</select>

	<!-- 이달의 도서 팝업 조회 -->
	<select id="selectPopup" resultMap="ScheduleMap">
		SELECT /* selectScheduleList */
			schedule.online_subject_schedule_id,

			book.book_id,
			book.book_thumbnail_file_id,

			COMTNFILE.ATCH_FILE_ID,
			COMTNFILEDETAIL.FILE_CN,
			COMTNFILEDETAIL.FILE_SN,
			COMTNFILEDETAIL.FILE_STRE_COURS,
			COMTNFILEDETAIL.STRE_FILE_NM,
			COMTNFILEDETAIL.FILE_EXTSN,
			COMTNFILEDETAIL.ORIGNL_FILE_NM,
			COMTNFILEDETAIL.FILE_SIZE,
			COMTNFILE.CREAT_DT,
			COMTNFILEDETAIL.DOWNLOAD_CNT
		FROM online_subject_schedule schedule
		INNER JOIN contents contents
			on schedule.contents_id = contents.contents_id
		INNER JOIN book book
			on contents.book_id = book.book_id
		LEFT JOIN COMTNFILE
			on book.book_thumbnail_file_id = COMTNFILE.ATCH_FILE_ID
		LEFT JOIN COMTNFILEDETAIL
			on book.book_thumbnail_file_id = COMTNFILEDETAIL.ATCH_FILE_ID
		WHERE 1=1
		  AND schedule.online_subject_schedule_id = #{onlineSubjectScheduleId}
	</select>
</mapper>