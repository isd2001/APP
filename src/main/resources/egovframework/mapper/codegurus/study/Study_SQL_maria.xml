<?xml version="1.0" encoding="UTF-8"?><!--Converted at: Wed May 11 15:49:38 KST 2016-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="codegurus.study.StudyDAO">

	<!-- 오늘의 학습 책 상세 조회 -->
	<select id="selectBookDetail" resultType="ResStudyBookVO">
		SELECT /* selectBookDetail */
			book_id,
		    book_title,
		    book_introduction,
		    book_thumbnail_file_id,
		    outline,
			outline_voice_file_id,
		    trailer,
		    trailer_active_ornot
		FROM book
		WHERE book_id=#{bookId}
	</select>

	<!-- 오늘의 학습 책 라벨 조회 -->
	<select id="selectLabelList" resultType="ResLabelListElemVO">
		SELECT /* selectLabelList */
			b.label_manage_id,
			b.label_domain_manage_id,
			b.label_title,
			b.label_color
		FROM label_mapping a
		left outer join label_manage b
		on a.label_domain_manage_id= 1 /* 1:책 */
		and b.label_manage_id = a.label_manage_id
		and b.delete_ornot = 'N'
		WHERE a.object_manage_id = #{labelDomainManageId}
		and a.delete_ornot = 'N';
	</select>

	<!-- 오늘의 학습 책 한줄평 목록 조회 -->
	<select id="selectOnelineList" resultType="ResOnelineListElemVO">
		SELECT /* selectOnelineList */
			a.onelinereview_id,
			a.book_id,
			a.onelinereview_content,
			a.score,
			a.reg_id,
			DF14(a.reg_date) as reg_date,
			a.modify_id,
			DF14(a.modify_date) as modify_date,
			a.delete_ornot,
			b.user_manage_id,
			b.user_id,
			b.name,
		    CASE
		        WHEN ( SELECT count(*) FROM onelinereview_like WHERE onelinereview_id = a.onelinereview_id AND delete_ornot = 'N' AND reg_id = a.reg_id) = 1 THEN 'Y'
				ELSE 'N'
			END like_yn /* 좋아요 클릭 YN */
		FROM onelinereview a
		inner join user_manage b
		on a.reg_id = b.user_manage_id
		WHERE 1=1
		and a.book_id = #{bookId}
		and a.delete_ornot = 'N'
	</select>

	<!-- 학습 콘텐츠 조회 -->
	<select id="selectContentsList" resultType="ResStudyContentsElemVO">
		SELECT
			a.contents_id,
			a.contents_title,
		    a.book_id,
		    a.inspection_status,
			b.template_inst_id,
		    b.template_id,
		    b.json,
		    b.`order`,
		    b.type,
		    b.difficulty,
			c.cate_id,
			c.parents_id,
			c.depth,
			c.`order` as cate_order,
			c.cate_title,
			c.first_cate_title,
			c.second_cate_title,
			c.third_cate_title,
			c.fourth_cate_title,
			c.fifth_cate_title,
			c.sixth_cate_title,
			c.seventh_cate_title,
			c.eight_cate_title,
			c.ninth_cate_title,
			c.tenth_cate_title,
			c.first_cate_id,
			c.second_cate_id,
			c.third_cate_id,
			c.fourth_cate_id,
			c.fifth_cate_id,
			c.sixth_cate_id,
			c.seventh_cate_id,
			c.eight_cate_id,
			c.ninth_cate_id,
			c.tenth_cate_id
		FROM contents a
		inner join template_inst b
		on a.contents_id = b.contents_id
		and b.delete_ornot = 'N'
		inner join cate c
		on b.cate_id = c.cate_id
		and c.delete_ornot = 'N'
		WHERE 1=1
		and a.book_id=#{bookId}
		and a.inspection_status = '승인완료'
		and a.delete_ornot = 'N'
		order by b.`order` asc
	</select>
</mapper>