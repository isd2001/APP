<?xml version="1.0" encoding="UTF-8"?><!--Converted at: Wed May 11 15:49:38 KST 2016-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="codegurus.mypage.MypageDAO">
    <!-- 나의진도 목록 조회 -->
    <resultMap id="MagnitudeMap" type="ResScheduleVO" autoMapping="true">
        <id property="onlineSubjectScheduleId" column="online_subject_schedule_id" />
        <id property="contentsId" column="contents_id"/>
        <association property="contentsHistory" javaType="ContentsHistoryVO" autoMapping="true">
            <result property="endDate" column="end_date"/>
        </association>
        <association property="book" javaType="BookVO" autoMapping="true">
            <id property="bookId" column="book_id"/>
            <result property="bookThumbnailFileId" column="book_thumbnail_file_id"/>
            <association property="bookThumbnail" javaType="FileVO" autoMapping="true">
                <id property="atchFileId" column="book_thumbnail_file_id"/>
            </association>
        </association>
    </resultMap>
    <select id="selectmagnitudeList" resultMap="MagnitudeMap">
        SELECT /* selectmagnitudeList */
            schedule.online_subject_schedule_id,

            contents_history.contents_history_id,
            contents_history.end_date,

            contents.contents_id,

            book.book_id,
            book.book_title,
            book.book_thumbnail_file_id,

            COMTNFILE.ATCH_FILE_ID,
            COMTNFILEDETAIL.FILE_CN,
            COMTNFILEDETAIL.FILE_SN,
            COMTNFILEDETAIL.FILE_STRE_COURS,
            COMTNFILEDETAIL.STRE_FILE_NM,
            COMTNFILEDETAIL.FILE_EXTSN,
            COMTNFILEDETAIL.ORIGNL_FILE_NM,
            COMTNFILEDETAIL.FILE_SIZE,
            COMTNFILE.CREAT_DT,
            COMTNFILEDETAIL.DOWNLOAD_CNT
        FROM
            online_subject_schedule as schedule
        LEFT JOIN contents_history contents_history
            on schedule.ONLINE_SUBJECT_SCHEDULE_ID = contents_history.online_subject_schedule_id
            and contents_history.delete_ornot ='N'
        LEFT JOIN contents as contents
            on schedule.CONTENTS_ID = contents.contents_id
        LEFT JOIN book as book
            on contents.book_id = book.book_id
        LEFT JOIN COMTNFILE
            on book.book_thumbnail_file_id = COMTNFILE.ATCH_FILE_ID
        LEFT JOIN COMTNFILEDETAIL
            on book.book_thumbnail_file_id = COMTNFILEDETAIL.ATCH_FILE_ID
        where schedule.`month`=#{month}
            and schedule.active_ornot = 'Y'
            and contents_history.user_manage_id = #{userManageId}
        order by schedule.online_subject_schedule_id asc
    </select>

    <!-- 나의 책장 조회 -->
    <resultMap id="BookcaseMap" type="BookVO" autoMapping="true">
        <id property="bookId" column="book_id"/>
        <result property="bookThumbnailFileId" column="book_thumbnail_file_id"/>
        <association property="bookThumbnail" javaType="FileVO" autoMapping="true">
            <id property="atchFileId" column="book_thumbnail_file_id"/>
        </association>
        <collection property="labelList" ofType="LabelVO" autoMapping="true" />
    </resultMap>
    <select id="selectBookcaseList" resultMap="BookcaseMap">
        SELECT /* selectBookcaseList */
            book.book_id,
            book.book_title,
            book.book_introduction,
            book.book_thumbnail_file_id,

            labelManage.label_manage_id,
            labelManage.label_title,

            COMTNFILE.ATCH_FILE_ID,
            COMTNFILEDETAIL.FILE_CN,
            COMTNFILEDETAIL.FILE_SN,
            COMTNFILEDETAIL.FILE_STRE_COURS,
            COMTNFILEDETAIL.STRE_FILE_NM,
            COMTNFILEDETAIL.FILE_EXTSN,
            COMTNFILEDETAIL.ORIGNL_FILE_NM,
            COMTNFILEDETAIL.FILE_SIZE,
            COMTNFILE.CREAT_DT,
            COMTNFILEDETAIL.DOWNLOAD_CNT
        FROM contents_history as history
        LEFT JOIN online_subject_schedule as schedule
            on history.online_subject_schedule_id = schedule.online_subject_schedule_id
        INNER JOIN contents as contents
            on schedule.contents_id = contents.contents_id
        INNER JOIN book as book
            on contents.book_id = book.book_id
        LEFT JOIN COMTNFILE
            on book.book_thumbnail_file_id = COMTNFILE.ATCH_FILE_ID
        LEFT JOIN COMTNFILEDETAIL
            on book.book_thumbnail_file_id = COMTNFILEDETAIL.ATCH_FILE_ID
        LEFT JOIN label_mapping labelMapping
            on  labelMapping.label_domain_manage_id = 1 /* 1:책 */
            and labelMapping.object_manage_id = book.book_id
            and labelMapping.delete_ornot = 'N'
        LEFT JOIN label_manage labelManage
            on 	labelManage.label_manage_id = labelMapping.label_manage_id
            and labelManage.label_domain_manage_id = labelMapping.label_domain_manage_id
            and labelManage.delete_ornot = 'N'
        where history.delete_ornot = 'N'
        and   history.user_manage_id = #{userManageId}
    </select>

    <!-- 나의사전 목록 조회 -->
    <resultMap id="MyDicMap" type="ContentsHistoryVO" autoMapping="true">
        <id property="contentsHistoryId" column="contents_history_id"/>
        <association property="book" javaType = "BookVO" autoMapping="true">
            <id property="bookId" column="book_id" />
            <result property="bookTitle" column="book_title"/>
        </association>
        <collection property="templateInstList" ofType="TemplateInstVO" autoMapping="true">
            <id property="templateInstId" column="template_inst_id" />
            <result property="templateTitle" column="tempate_title"/>
            <result property="json" column="json"/>
        </collection>
    </resultMap>
    <select id="selectDicList" resultMap="MyDicMap">
        SELECT /* selectDicList */
            history.contents_history_id,
            book.book_id,
            book.book_title,

            template_inst.template_inst_id,
            template_inst.json,
            template_inst.template_id,
            template.template_title

        FROM contents_history as history
                 left join template_inst_history as tempate_inst_history
                           on history.contents_history_id = tempate_inst_history.contents_history_id
                 LEFT JOIN online_subject_schedule as schedule
                           on history.online_subject_schedule_id = schedule.online_subject_schedule_id
                 left JOIN contents as contents
                           on schedule.contents_id = contents.contents_id
                 LEFT JOIN template_inst as template_inst
                           on contents.contents_id = template_inst.contents_id
                    and tempate_inst_history.template_inst_id = template_inst.template_inst_id
                               and template_inst.delete_ornot='N'
                 LEFT JOIN template as template
                           on template_inst.template_id = template.template_id
                               and template.delete_ornot = 'N'
                 INNER JOIN book as book
                            on contents.book_id = book.book_id
        where history.delete_ornot = 'N'
          and   history.user_manage_id = #{userManageId}
    </select>

    <!-- 나의 포트폴리오 목록 조회 -->
    <resultMap id="PortfilioMap" type="ResScheduleVO" autoMapping="true">
        <id property="onlineSubjectScheduleId" column="online_subject_schedule_id" />
        <id property="contentsId" column="contents_id"/>
        <association property="contentsHistory" javaType="ContentsHistoryVO" autoMapping="true">
            <result property="endDate" column="end_date"/>
            <association property="drawingFile" javaType="FileVO" autoMapping="true">
                <id property="atchFileId" column="summary_doing_drawing_file_id"/>
            </association>
            <association property="voiceFile" javaType="FileVO" autoMapping="true">
                <id property="atchFileId" column="summary_doing_voice_file_id"/>
            </association>
        </association>
        <association property="book" javaType="BookVO" autoMapping="true">
            <id property="bookId" column="book_id"/>
            <result property="bookThumbnailFileId" column="book_thumbnail_file_id"/>
            <association property="bookThumbnail" javaType="FileVO" autoMapping="true">
                <id property="atchFileId" column="book_thumbnail_file_id"/>
            </association>
        </association>
    </resultMap>
    <select id="selectportfolioList" resultMap="PortfilioMap">
        SELECT /* selectmagnitudeList */
            schedule.online_subject_schedule_id,

            contents_history.contents_history_id,
            contents_history.summary_doing_drawing_file_id ,
            contents_history.summary_doing_voice_file_id,
            contents_history.end_date,

            DRAWING_COMTNFILE.ATCH_FILE_ID as DRAWING_ATCH_FILE_ID,
            DRAWING_COMTNFILEDETAIL.FILE_CN as DRAWING_FILE_CN,
            DRAWING_COMTNFILEDETAIL.FILE_SN as DRAWING,
            DRAWING_COMTNFILEDETAIL.FILE_STRE_COURS as DRAWING,
            DRAWING_COMTNFILEDETAIL.STRE_FILE_NM as DRAWING,
            DRAWING_COMTNFILEDETAIL.FILE_EXTSN as DRAWING,
            DRAWING_COMTNFILEDETAIL.ORIGNL_FILE_NM as DRAWING,
            DRAWING_COMTNFILEDETAIL.FILE_SIZE as DRAWING,
            DRAWING_COMTNFILE.CREAT_DT as DRAWING,
            DRAWING_COMTNFILEDETAIL.DOWNLOAD_CNT as DRAWING,

            VOICE_COMTNFILE.ATCH_FILE_ID as VOICE_,
            VOICE_COMTNFILEDETAIL.FILE_CN,
            VOICE_COMTNFILEDETAIL.FILE_SN,
            VOICE_COMTNFILEDETAIL.FILE_STRE_COURS,
            VOICE_COMTNFILEDETAIL.STRE_FILE_NM,
            VOICE_COMTNFILEDETAIL.FILE_EXTSN,
            VOICE_COMTNFILEDETAIL.ORIGNL_FILE_NM,
            VOICE_COMTNFILEDETAIL.FILE_SIZE,
            VOICE_COMTNFILE.CREAT_DT,
            VOICE_COMTNFILEDETAIL.DOWNLOAD_CNT,

            contents.contents_id,

            book.book_id,
            book.book_title,
            book.book_thumbnail_file_id,

            COMTNFILE.ATCH_FILE_ID,
            COMTNFILEDETAIL.FILE_CN,
            COMTNFILEDETAIL.FILE_SN,
            COMTNFILEDETAIL.FILE_STRE_COURS,
            COMTNFILEDETAIL.STRE_FILE_NM,
            COMTNFILEDETAIL.FILE_EXTSN,
            COMTNFILEDETAIL.ORIGNL_FILE_NM,
            COMTNFILEDETAIL.FILE_SIZE,
            COMTNFILE.CREAT_DT,
            COMTNFILEDETAIL.DOWNLOAD_CNT
        FROM
            online_subject_schedule as schedule
        LEFT JOIN contents_history contents_history
            on schedule.ONLINE_SUBJECT_SCHEDULE_ID = contents_history.online_subject_schedule_id
            and contents_history.delete_ornot ='N'
        LEFT join COMTNFILE as DRAWING_COMTNFILE
            on contents_history.summary_doing_drawing_file_id = DRAWING_COMTNFILE.ATCH_FILE_ID
        LEFT JOIN COMTNFILEDETAIL as DRAWING_COMTNFILEDETAIL
            on contents_history.summary_doing_drawing_file_id = DRAWING_COMTNFILEDETAIL.ATCH_FILE_ID
        LEFT join COMTNFILE as VOICE_COMTNFILE
            on contents_history.summary_doing_voice_file_id = VOICE_COMTNFILE.ATCH_FILE_ID
        LEFT JOIN COMTNFILEDETAIL as VOICE_COMTNFILEDETAIL
            on contents_history.summary_doing_voice_file_id = VOICE_COMTNFILEDETAIL.ATCH_FILE_ID
        LEFT JOIN contents as contents
            on schedule.CONTENTS_ID = contents.contents_id
            and contents_history.user_manage_id = #{userManageId}
        LEFT JOIN book as book
            on contents.book_id = book.book_id
        LEFT JOIN COMTNFILE
            on book.book_thumbnail_file_id = COMTNFILE.ATCH_FILE_ID
        LEFT JOIN COMTNFILEDETAIL
            on book.book_thumbnail_file_id = COMTNFILEDETAIL.ATCH_FILE_ID
        where schedule.`month`=#{month}
            and schedule.active_ornot = 'Y'
            and   contents_history.user_manage_id = #{userManageId}
        order by schedule.online_subject_schedule_id asc
    </select>
</mapper>